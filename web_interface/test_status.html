<!DOCTYPE html>
<html>
<head>
    <title>配置状态显示测试</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .card { background: white; padding: 20px; margin: 20px 0; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status-badge { padding: 0.25rem 0.75rem; border-radius: 20px; font-size: 0.8rem; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; }
        .status-badge.success { background: #28a745; color: white; }
        .status-badge.warning { background: #ffc107; color: white; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; box-sizing: border-box; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .info { background: #d1ecf1; color: #0c5460; }
        .config-section { border: 1px solid #ddd; padding: 15px; margin: 10px 0; border-radius: 4px; }
        .config-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 配置状态显示测试</h1>
        
        <div class="card">
            <h2>📝 测试配置保存和状态显示</h2>
            
            <div class="config-section">
                <div class="config-header">
                    <h3>本地模型配置</h3>
                    <span class="status-badge warning" id="local-status">未配置</span>
                </div>
                <div class="form-group">
                    <label for="local-url">本地API地址:</label>
                    <input type="text" id="local-url" value="http://192.168.210.209:11434/api/generate">
                </div>
                <div class="form-group">
                    <label for="local-model">模型名称:</label>
                    <input type="text" id="local-model" value="deepseek-r1">
                </div>
                <div class="form-group">
                    <label for="local-timeout">超时时间(秒):</label>
                    <input type="number" id="local-timeout" value="30">
                </div>
                <button onclick="saveLocalConfig()">💾 保存配置</button>
                <button onclick="loadLocalConfig()">📂 加载配置</button>
                <button onclick="clearLocalConfig()">🗑️ 清除配置</button>
            </div>
            
            <div class="config-section">
                <div class="config-header">
                    <h3>OpenAI配置</h3>
                    <span class="status-badge warning" id="openai-status">未配置</span>
                </div>
                <div class="form-group">
                    <label for="openai-key">API Key:</label>
                    <input type="password" id="openai-key" value="sk-test-key">
                </div>
                <div class="form-group">
                    <label for="openai-url">API URL:</label>
                    <input type="text" id="openai-url" value="https://api.openai.com/v1">
                </div>
                <button onclick="saveOpenAIConfig()">💾 保存配置</button>
                <button onclick="loadOpenAIConfig()">📂 加载配置</button>
                <button onclick="clearOpenAIConfig()">🗑️ 清除配置</button>
            </div>
            
            <div class="config-section">
                <div class="config-header">
                    <h3>GLM配置</h3>
                    <span class="status-badge warning" id="glm-status">未配置</span>
                </div>
                <div class="form-group">
                    <label for="glm-key">API Key:</label>
                    <input type="password" id="glm-key" value="glm-test-key">
                </div>
                <div class="form-group">
                    <label for="glm-url">API URL:</label>
                    <input type="text" id="glm-url" value="https://open.bigmodel.cn/api/paas/v4">
                </div>
                <button onclick="saveGLMConfig()">💾 保存配置</button>
                <button onclick="loadGLMConfig()">📂 加载配置</button>
                <button onclick="clearGLMConfig()">🗑️ 清除配置</button>
            </div>
        </div>
        
        <div class="card">
            <h2>📊 测试结果</h2>
            <div id="test-results"></div>
        </div>
    </div>

    <script>
        // 更新状态显示
        function updateStatus(type, status) {
            const statusElement = document.getElementById(type + '-status');
            statusElement.textContent = status;
            
            // 已连接和已配置都显示为成功状态
            const isSuccess = status === '已连接' || status === '已配置';
            statusElement.className = 'status-badge ' + (isSuccess ? 'success' : 'warning');
        }
        
        // 显示测试结果
        function showResult(message, type) {
            const resultsDiv = document.getElementById('test-results');
            const resultElement = document.createElement('div');
            resultElement.className = `test-result ${type}`;
            resultElement.textContent = message;
            resultsDiv.appendChild(resultElement);
            
            setTimeout(() => {
                if (resultElement.parentNode) {
                    resultElement.remove();
                }
            }, 3000);
        }
        
        // 本地模型配置函数
        function saveLocalConfig() {
            const config = {
                url: document.getElementById('local-url').value,
                model: document.getElementById('local-model').value,
                timeout: document.getElementById('local-timeout').value
            };
            
            localStorage.setItem('local_config', JSON.stringify(config));
            updateStatus('local', '已配置');
            showResult('✅ 本地模型配置已保存，状态更新为"已配置"', 'success');
        }
        
        function loadLocalConfig() {
            const config = localStorage.getItem('local_config');
            if (config) {
                const parsedConfig = JSON.parse(config);
                document.getElementById('local-url').value = parsedConfig.url || '';
                document.getElementById('local-model').value = parsedConfig.model || '';
                document.getElementById('local-timeout').value = parsedConfig.timeout || 30;
                
                if (parsedConfig.url && parsedConfig.model) {
                    updateStatus('local', '已配置');
                    showResult('✅ 本地模型配置已加载，状态显示为"已配置"', 'success');
                } else {
                    updateStatus('local', '未配置');
                    showResult('⚠️ 本地模型配置不完整，状态显示为"未配置"', 'info');
                }
            } else {
                updateStatus('local', '未配置');
                showResult('⚠️ 没有找到本地模型配置', 'info');
            }
        }
        
        function clearLocalConfig() {
            localStorage.removeItem('local_config');
            document.getElementById('local-url').value = '';
            document.getElementById('local-model').value = '';
            document.getElementById('local-timeout').value = '30';
            updateStatus('local', '未配置');
            showResult('🗑️ 本地模型配置已清除，状态更新为"未配置"', 'info');
        }
        
        // OpenAI配置函数
        function saveOpenAIConfig() {
            const config = {
                key: document.getElementById('openai-key').value,
                url: document.getElementById('openai-url').value
            };
            
            localStorage.setItem('openai_config', JSON.stringify(config));
            updateStatus('openai', '已配置');
            showResult('✅ OpenAI配置已保存，状态更新为"已配置"', 'success');
        }
        
        function loadOpenAIConfig() {
            const config = localStorage.getItem('openai_config');
            if (config) {
                const parsedConfig = JSON.parse(config);
                document.getElementById('openai-key').value = parsedConfig.key || '';
                document.getElementById('openai-url').value = parsedConfig.url || '';
                
                if (parsedConfig.key && parsedConfig.url) {
                    updateStatus('openai', '已配置');
                    showResult('✅ OpenAI配置已加载，状态显示为"已配置"', 'success');
                } else {
                    updateStatus('openai', '未配置');
                    showResult('⚠️ OpenAI配置不完整，状态显示为"未配置"', 'info');
                }
            } else {
                updateStatus('openai', '未配置');
                showResult('⚠️ 没有找到OpenAI配置', 'info');
            }
        }
        
        function clearOpenAIConfig() {
            localStorage.removeItem('openai_config');
            document.getElementById('openai-key').value = '';
            document.getElementById('openai-url').value = '';
            updateStatus('openai', '未配置');
            showResult('🗑️ OpenAI配置已清除，状态更新为"未配置"', 'info');
        }
        
        // GLM配置函数
        function saveGLMConfig() {
            const config = {
                key: document.getElementById('glm-key').value,
                url: document.getElementById('glm-url').value
            };
            
            localStorage.setItem('glm_config', JSON.stringify(config));
            updateStatus('glm', '已配置');
            showResult('✅ GLM配置已保存，状态更新为"已配置"', 'success');
        }
        
        function loadGLMConfig() {
            const config = localStorage.getItem('glm_config');
            if (config) {
                const parsedConfig = JSON.parse(config);
                document.getElementById('glm-key').value = parsedConfig.key || '';
                document.getElementById('glm-url').value = parsedConfig.url || '';
                
                if (parsedConfig.key && parsedConfig.url) {
                    updateStatus('glm', '已配置');
                    showResult('✅ GLM配置已加载，状态显示为"已配置"', 'success');
                } else {
                    updateStatus('glm', '未配置');
                    showResult('⚠️ GLM配置不完整，状态显示为"未配置"', 'info');
                }
            } else {
                updateStatus('glm', '未配置');
                showResult('⚠️ 没有找到GLM配置', 'info');
            }
        }
        
        function clearGLMConfig() {
            localStorage.removeItem('glm_config');
            document.getElementById('glm-key').value = '';
            document.getElementById('glm-url').value = '';
            updateStatus('glm', '未配置');
            showResult('🗑️ GLM配置已清除，状态更新为"未配置"', 'info');
        }
        
        // 页面加载时自动加载所有配置
        window.onload = function() {
            loadLocalConfig();
            loadOpenAIConfig();
            loadGLMConfig();
            showResult('📄 页面加载完成，已自动检查所有配置状态', 'info');
        };
    </script>
</body>
</html>
