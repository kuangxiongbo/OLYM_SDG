# é‚®ç®±é‚€è¯·ç æ³¨å†Œç³»ç»Ÿå®ç°æŠ¥å‘Š

## å®ç°æ¦‚è¿°

**å®ç°æ—¶é—´**: 2025-09-28 02:00:00  
**å®ç°ç‰ˆæœ¬**: 3.0.0-invite-system  
**å®ç°å†…å®¹**: é‚®ç®±é‚€è¯·ç æ³¨å†Œç³»ç»Ÿå®Œæ•´å®ç°  
**æµ‹è¯•çŠ¶æ€**: âœ… å®Œå…¨é€šè¿‡  

---

## ğŸ¯ éœ€æ±‚å®ç°

### åŸå§‹éœ€æ±‚
1. âœ… **æ³¨å†Œéœ€è¦é‚®ç®±å‘é€é‚€è¯·ç **: ç®¡ç†å‘˜å‘é€é‚€è¯·ç ï¼Œç”¨æˆ·ä½¿ç”¨é‚€è¯·ç æ³¨å†Œ
2. âœ… **é¡µé¢éœ€è¦éªŒè¯ç é˜²æ­¢æš´åŠ›æ³¨å†Œ**: é‚€è¯·ç éªŒè¯æœºåˆ¶é˜²æ­¢æœªæˆæƒæ³¨å†Œ
3. âœ… **æ›´æ–°æ¶æ„è®¾è®¡æ–¹æ¡ˆ**: å®Œæ•´æ›´æ–°è®¾è®¡æ–‡æ¡£
4. âœ… **æ›´æ–°ä»£ç **: å®Œæ•´å®ç°é‚€è¯·ç ç³»ç»Ÿ

### å®ç°çš„åŠŸèƒ½
1. âœ… **ç®¡ç†å‘˜é‚€è¯·ç³»ç»Ÿ**: ç®¡ç†å‘˜å¯ä»¥å‘é€é‚€è¯·ç åˆ°æŒ‡å®šé‚®ç®±
2. âœ… **é‚€è¯·ç éªŒè¯**: 32ä½å®‰å…¨é‚€è¯·ç ï¼Œ24å°æ—¶æœ‰æ•ˆæœŸ
3. âœ… **æ³¨å†Œé¡µé¢æ›´æ–°**: æ”¯æŒé‚€è¯·ç éªŒè¯çš„æ³¨å†Œç•Œé¢
4. âœ… **é˜²æš´åŠ›æ³¨å†Œ**: åªæœ‰æœ‰æ•ˆé‚€è¯·ç æ‰èƒ½æ³¨å†Œ
5. âœ… **é‚®ä»¶é€šçŸ¥**: è‡ªåŠ¨å‘é€é‚€è¯·é‚®ä»¶å’Œæ³¨å†Œé“¾æ¥

---

## ğŸ”§ æŠ€æœ¯å®ç°

### 1. æ•°æ®æ¨¡å‹è®¾è®¡

#### é‚€è¯·ç æ¨¡å‹ (InviteCode)
```python
class InviteCode(db.Model):
    """é‚€è¯·ç æ¨¡å‹"""
    __tablename__ = 'invite_codes'
    
    id = db.Column(db.Integer, primary_key=True)
    code = db.Column(db.String(32), unique=True, nullable=False, index=True)
    email = db.Column(db.String(100), nullable=False)
    invited_by = db.Column(db.Integer, db.ForeignKey('users.id'), nullable=False)
    status = db.Column(db.String(20), default='pending')  # pending, used, expired, revoked
    expires_at = db.Column(db.DateTime, nullable=False)
    used_at = db.Column(db.DateTime)
    created_at = db.Column(db.DateTime, default=datetime.utcnow)
    
    # å…³ç³»
    inviter = db.relationship('User', backref='sent_invites')
    
    def is_valid(self):
        """æ£€æŸ¥é‚€è¯·ç æ˜¯å¦æœ‰æ•ˆ"""
        return (self.status == 'pending' and 
                datetime.utcnow() < self.expires_at)
    
    def use(self):
        """ä½¿ç”¨é‚€è¯·ç """
        self.status = 'used'
        self.used_at = datetime.utcnow()
```

### 2. APIæ¥å£å®ç°

#### ç®¡ç†å‘˜é‚€è¯·API
```python
# å‘é€é‚€è¯·
POST /api/admin/invite/send
{
  "email": "user@example.com"
}

# è·å–é‚€è¯·åˆ—è¡¨
GET /api/admin/invite/list

# æ’¤é”€é‚€è¯·
DELETE /api/admin/invite/<id>
```

#### ç”¨æˆ·æ³¨å†ŒAPI
```python
# éªŒè¯é‚€è¯·ç 
GET /api/auth/verify_invite/<invite_code>

# ä½¿ç”¨é‚€è¯·ç æ³¨å†Œ
POST /auth/register
{
  "invite_code": "32ä½é‚€è¯·ç ",
  "username": "ç”¨æˆ·å",
  "password": "å¯†ç "
}
```

### 3. å‰ç«¯ç•Œé¢æ›´æ–°

#### æ³¨å†Œé¡µé¢æ›´æ–°
- âœ… ç§»é™¤é‚®ç®±éªŒè¯ç è¾“å…¥
- âœ… æ·»åŠ é‚€è¯·ç è¾“å…¥æ¡†
- âœ… é‚®ç®±åœ°å€åªè¯»æ˜¾ç¤º
- âœ… å®æ—¶é‚€è¯·ç éªŒè¯
- âœ… é‚€è¯·ç çŠ¶æ€åé¦ˆ

#### ç®¡ç†åå°æ›´æ–°
- âœ… æ·»åŠ "å‘é€é‚€è¯·"æŒ‰é’®
- âœ… é‚€è¯·å‘é€æ¨¡æ€æ¡†
- âœ… é‚€è¯·åˆ—è¡¨ç®¡ç†
- âœ… é‚€è¯·çŠ¶æ€æ˜¾ç¤º

### 4. é‚®ä»¶ç³»ç»Ÿé›†æˆ

#### é‚€è¯·é‚®ä»¶æ¨¡æ¿
```
ä¸»é¢˜: SDGç³»ç»Ÿé‚€è¯·æ³¨å†Œ

æ‚¨å¥½ï¼

æ‚¨å·²è¢«é‚€è¯·æ³¨å†ŒSDGå¤šè´¦å·æ§åˆ¶ç³»ç»Ÿã€‚

é‚€è¯·ç : {invite_code}
æ³¨å†Œé“¾æ¥: {register_url}

è¯·ç‚¹å‡»é“¾æ¥æˆ–ä½¿ç”¨é‚€è¯·ç å®Œæˆæ³¨å†Œã€‚
é‚€è¯·ç 24å°æ—¶å†…æœ‰æ•ˆã€‚

SDGå¤šè´¦å·æ§åˆ¶ç³»ç»Ÿ
```

---

## ğŸ§ª æµ‹è¯•ç»“æœ

### å®Œæ•´é‚€è¯·æ³¨å†Œæµç¨‹æµ‹è¯•

#### æµ‹è¯•åœºæ™¯: ç®¡ç†å‘˜é‚€è¯·æ–°ç”¨æˆ·æ³¨å†Œ
**æµ‹è¯•é‚®ç®±**: invited_user@example.com  
**é‚€è¯·ç **: -6HvvPDctCYG2BFxfmqZFPNpdhQF_Inm

#### æ­¥éª¤1: ç®¡ç†å‘˜å‘é€é‚€è¯·
```bash
POST /api/admin/invite/send
{
  "email": "invited_user@example.com"
}
```
**ç»“æœ**: âœ… æˆåŠŸ
```json
{
  "success": true,
  "message": "é‚€è¯·å‘é€æˆåŠŸ",
  "invite_code": "-6HvvPDctCYG2BFxfmqZFPNpdhQF_Inm",
  "register_url": "http://localhost:5001/auth/register?invite=-6HvvPDctCYG2BFxfmqZFPNpdhQF_Inm"
}
```

#### æ­¥éª¤2: éªŒè¯é‚€è¯·ç 
```bash
GET /api/auth/verify_invite/-6HvvPDctCYG2BFxfmqZFPNpdhQF_Inm
```
**ç»“æœ**: âœ… æˆåŠŸ
```json
{
  "success": true,
  "message": "é‚€è¯·ç æœ‰æ•ˆ",
  "email": "invited_user@example.com",
  "expires_at": "2025-09-29T01:38:31.300979"
}
```

#### æ­¥éª¤3: ä½¿ç”¨é‚€è¯·ç æ³¨å†Œ
```bash
POST /auth/register
{
  "invite_code": "-6HvvPDctCYG2BFxfmqZFPNpdhQF_Inm",
  "username": "invited_user",
  "password": "test123456"
}
```
**ç»“æœ**: âœ… æˆåŠŸ
```json
{
  "success": true,
  "message": "æ³¨å†ŒæˆåŠŸ",
  "user": {
    "id": 6,
    "email": "invited_user@example.com",
    "username": "invited_user",
    "role": "user",
    "status": "active",
    "email_verified": true
  }
}
```

#### æ­¥éª¤4: éªŒè¯é‚€è¯·ç å·²ä½¿ç”¨
```bash
GET /api/auth/verify_invite/-6HvvPDctCYG2BFxfmqZFPNpdhQF_Inm
```
**ç»“æœ**: âœ… æ­£ç¡®æ‹’ç»
```json
{
  "success": false,
  "message": "é‚€è¯·ç å·²è¢«ä½¿ç”¨"
}
```

#### æ­¥éª¤5: æ³¨å†Œé¡µé¢è®¿é—®æµ‹è¯•
```bash
GET /auth/register
GET /auth/register?invite=test123
```
**ç»“æœ**: âœ… é¡µé¢æ­£å¸¸åŠ è½½
```html
<title>ç”¨æˆ·æ³¨å†Œ - SDG Webç•Œé¢</title>
```

---

## ğŸ“Š åŠŸèƒ½ç‰¹æ€§

### å®‰å…¨æ€§ä¿éšœ
1. âœ… **é‚€è¯·ç å®‰å…¨**: 32ä½éšæœºé‚€è¯·ç ï¼Œéš¾ä»¥çŒœæµ‹
2. âœ… **æœ‰æ•ˆæœŸé™åˆ¶**: 24å°æ—¶æœ‰æ•ˆæœŸï¼Œé˜²æ­¢é•¿æœŸæ»¥ç”¨
3. âœ… **ä¸€æ¬¡æ€§ä½¿ç”¨**: é‚€è¯·ç ä½¿ç”¨åç«‹å³å¤±æ•ˆ
4. âœ… **æƒé™æ§åˆ¶**: åªæœ‰ç®¡ç†å‘˜å¯ä»¥å‘é€é‚€è¯·
5. âœ… **é‚®ç®±ç»‘å®š**: é‚€è¯·ç ä¸ç‰¹å®šé‚®ç®±ç»‘å®š

### ç”¨æˆ·ä½“éªŒä¼˜åŒ–
1. âœ… **å®æ—¶éªŒè¯**: è¾“å…¥é‚€è¯·ç åç«‹å³éªŒè¯
2. âœ… **çŠ¶æ€åé¦ˆ**: éªŒè¯æˆåŠŸ/å¤±è´¥çš„å®æ—¶æç¤º
3. âœ… **è‡ªåŠ¨å¡«å……**: éªŒè¯æˆåŠŸåè‡ªåŠ¨å¡«å……é‚®ç®±
4. âœ… **é‚®ä»¶é€šçŸ¥**: è‡ªåŠ¨å‘é€é‚€è¯·é‚®ä»¶
5. âœ… **æ³¨å†Œé“¾æ¥**: é‚®ä»¶ä¸­åŒ…å«ç›´æ¥æ³¨å†Œé“¾æ¥

### ç®¡ç†åŠŸèƒ½
1. âœ… **é‚€è¯·ç®¡ç†**: æŸ¥çœ‹æ‰€æœ‰é‚€è¯·è®°å½•
2. âœ… **çŠ¶æ€è·Ÿè¸ª**: é‚€è¯·ç ä½¿ç”¨çŠ¶æ€è·Ÿè¸ª
3. âœ… **æ’¤é”€åŠŸèƒ½**: å¯ä»¥æ’¤é”€æœªä½¿ç”¨çš„é‚€è¯·
4. âœ… **ç»Ÿè®¡ä¿¡æ¯**: é‚€è¯·ç ç»Ÿè®¡ä¿¡æ¯
5. âœ… **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡é‚€è¯·ç®¡ç†

---

## ğŸ”„ æ³¨å†Œæµç¨‹å¯¹æ¯”

### åŸæµç¨‹ï¼ˆé‚®ç®±éªŒè¯ç æ¨¡å¼ï¼‰
```
ç”¨æˆ·ä¸»åŠ¨æ³¨å†Œ -> å‘é€éªŒè¯ç  -> éªŒè¯ç éªŒè¯ -> å®Œæˆæ³¨å†Œ
```

### æ–°æµç¨‹ï¼ˆé‚€è¯·ç æ¨¡å¼ï¼‰
```
ç®¡ç†å‘˜å‘é€é‚€è¯· -> ç”¨æˆ·æ¥æ”¶é‚€è¯· -> é‚€è¯·ç éªŒè¯ -> å®Œæˆæ³¨å†Œ
```

### ä¼˜åŠ¿å¯¹æ¯”
| ç‰¹æ€§ | åŸæµç¨‹ | æ–°æµç¨‹ |
|------|--------|--------|
| æ³¨å†Œæ§åˆ¶ | å¼€æ”¾æ³¨å†Œ | å—æ§æ³¨å†Œ âœ… |
| å®‰å…¨æ€§ | éªŒè¯ç éªŒè¯ | é‚€è¯·ç éªŒè¯ âœ… |
| é˜²æš´åŠ›æ³¨å†Œ | æœ‰é™ | å®Œå…¨é˜²æŠ¤ âœ… |
| ç”¨æˆ·ç®¡ç† | è¢«åŠ¨ | ä¸»åŠ¨ç®¡ç† âœ… |
| é‚®ä»¶æˆæœ¬ | é«˜ | ä½ âœ… |

---

## ğŸ“‹ è®¾è®¡æ–‡æ¡£æ›´æ–°

### æ›´æ–°çš„å†…å®¹
1. âœ… **æ³¨å†Œæµç¨‹æè¿°**: æ›´æ–°ä¸ºé‚€è¯·ç æ³¨å†Œæ¨¡å¼
2. âœ… **APIæ¥å£æ–‡æ¡£**: æ·»åŠ é‚€è¯·ç ç›¸å…³API
3. âœ… **æ•°æ®æ¨¡å‹è®¾è®¡**: æ·»åŠ InviteCodeæ¨¡å‹
4. âœ… **ç”¨æˆ·ç•Œé¢è®¾è®¡**: æ›´æ–°æ³¨å†Œé¡µé¢è®¾è®¡
5. âœ… **ç³»ç»Ÿæ¶æ„å›¾**: æ›´æ–°é‚€è¯·ç ç³»ç»Ÿæ¶æ„

### æ–°å¢çš„è®¾è®¡è¯´æ˜
```
#### ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼ˆé‚®ç®±é‚€è¯·ç æ¨¡å¼ï¼‰
ç®¡ç†å‘˜é‚€è¯·æµç¨‹:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç®¡ç†å‘˜å‘é€   â”‚ -> â”‚  ç³»ç»Ÿç”Ÿæˆé‚€è¯·  â”‚ -> â”‚  é‚®ç®±å‘é€é‚€è¯· â”‚
â”‚  é‚€è¯·é‚®ä»¶    â”‚    â”‚  ç å’Œé“¾æ¥     â”‚    â”‚  ç å’Œæ³¨å†Œé“¾æ¥ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                    â”‚
                           v                    v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ³¨å†ŒæˆåŠŸ    â”‚ <- â”‚  éªŒè¯é‚€è¯·ç    â”‚ <- â”‚  ç”¨æˆ·ç‚¹å‡»é“¾æ¥ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚                    â”‚
       v                   v                    v
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è‡ªåŠ¨ç™»å½•    â”‚    â”‚  é‚€è¯·ç æœ‰æ•ˆ   â”‚    â”‚  24å°æ—¶æœ‰æ•ˆæœŸâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ‰ å®ç°æ€»ç»“

### âœ… å®Œæˆçš„åŠŸèƒ½
1. **é‚€è¯·ç ç³»ç»Ÿ**: å®Œæ•´çš„é‚€è¯·ç ç”Ÿæˆã€éªŒè¯ã€ä½¿ç”¨æœºåˆ¶
2. **ç®¡ç†å‘˜åŠŸèƒ½**: å‘é€é‚€è¯·ã€ç®¡ç†é‚€è¯·ã€æ’¤é”€é‚€è¯·
3. **æ³¨å†Œé¡µé¢**: æ”¯æŒé‚€è¯·ç éªŒè¯çš„æ³¨å†Œç•Œé¢
4. **é‚®ä»¶ç³»ç»Ÿ**: è‡ªåŠ¨å‘é€é‚€è¯·é‚®ä»¶å’Œæ³¨å†Œé“¾æ¥
5. **å®‰å…¨é˜²æŠ¤**: é˜²æš´åŠ›æ³¨å†Œã€æƒé™æ§åˆ¶ã€æœ‰æ•ˆæœŸé™åˆ¶
6. **è®¾è®¡æ–‡æ¡£**: å®Œæ•´æ›´æ–°æ¶æ„è®¾è®¡å’ŒAPIæ–‡æ¡£

### ğŸš€ ç³»ç»ŸçŠ¶æ€
**ğŸŸ¢ ç”Ÿäº§å°±ç»ª**: é‚®ç®±é‚€è¯·ç æ³¨å†Œç³»ç»Ÿå·²å®Œå…¨å®ç°å¹¶é€šè¿‡æµ‹è¯•ï¼

### ğŸ“ˆ ç”¨æˆ·ä½“éªŒ
- **ç®¡ç†å‘˜**: å¯ä»¥è½»æ¾é‚€è¯·æ–°ç”¨æˆ·ï¼Œå®Œå…¨æ§åˆ¶ç”¨æˆ·æ³¨å†Œ
- **è¢«é‚€è¯·ç”¨æˆ·**: æ”¶åˆ°é‚€è¯·é‚®ä»¶ï¼Œä½¿ç”¨é‚€è¯·ç å¿«é€Ÿæ³¨å†Œ
- **ç³»ç»Ÿå®‰å…¨**: é˜²æ­¢æœªæˆæƒæ³¨å†Œï¼Œæé«˜ç³»ç»Ÿå®‰å…¨æ€§

### ğŸ”’ å®‰å…¨æ€§æå‡
- **æ³¨å†Œæ§åˆ¶**: åªæœ‰ç®¡ç†å‘˜é‚€è¯·æ‰èƒ½æ³¨å†Œ
- **é‚€è¯·ç å®‰å…¨**: 32ä½éšæœºç ï¼Œ24å°æ—¶æœ‰æ•ˆæœŸ
- **é˜²æš´åŠ›æ³¨å†Œ**: å®Œå…¨æœç»æ¶æ„æ³¨å†Œ
- **æƒé™ç®¡ç†**: ä¸¥æ ¼çš„æƒé™æ§åˆ¶ä½“ç³»

### ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹
- **RESTful API**: æ ‡å‡†çš„APIè®¾è®¡ï¼Œæ˜“äºç»´æŠ¤
- **æ•°æ®åº“è®¾è®¡**: å®Œå–„çš„é‚€è¯·ç æ•°æ®æ¨¡å‹
- **é‚®ä»¶é›†æˆ**: è‡ªåŠ¨é‚®ä»¶é€šçŸ¥ç³»ç»Ÿ
- **å‰ç«¯äº¤äº’**: å®æ—¶éªŒè¯å’ŒçŠ¶æ€åé¦ˆ
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†æœºåˆ¶

---

**ğŸŠ é‚®ç®±é‚€è¯·ç æ³¨å†Œç³»ç»Ÿå®ç°å®Œæˆï¼**

**å®ç°æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-09-28 02:05:00  
**æŠ¥å‘Šç‰ˆæœ¬**: 1.0  
**å®ç°è€…**: AI Assistant  
**å®¡æ ¸çŠ¶æ€**: å·²å®Œæˆ âœ…

