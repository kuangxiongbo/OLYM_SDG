{% extends "base.html" %}

{% block title %}向导功能测试 - SDG 工具集{% endblock %}

{% block content %}
<div class="unified-wizard-page">
    <!-- 页面头部 -->
    <div class="page-header">
        <h1 class="page-title">向导功能测试</h1>
        <p class="page-description">测试向导步骤切换和导航功能</p>
    </div>

    <!-- 向导步骤指示器 -->
    <div class="wizard-steps">
        <div class="step active" data-step="1">
            <div class="step-number">1</div>
            <div class="step-title">步骤一</div>
            <div class="step-description">测试第一步</div>
        </div>
        <div class="step" data-step="2">
            <div class="step-number">2</div>
            <div class="step-title">步骤二</div>
            <div class="step-description">测试第二步</div>
        </div>
        <div class="step" data-step="3">
            <div class="step-number">3</div>
            <div class="step-title">步骤三</div>
            <div class="step-description">测试第三步</div>
        </div>
        <div class="step" data-step="4">
            <div class="step-number">4</div>
            <div class="step-title">步骤四</div>
            <div class="step-description">测试第四步</div>
        </div>
    </div>

    <!-- 向导内容区域 -->
    <div class="wizard-content">
        <div class="wizard-step active" id="step-1">
            <h3>步骤一：数据上传</h3>
            <p>这是第一步的内容。请上传您的数据文件。</p>
            <div class="form-group">
                <label>选择文件：</label>
                <input type="file" id="file-input" accept=".csv,.xlsx,.xls">
            </div>
        </div>
        
        <div class="wizard-step" id="step-2">
            <h3>步骤二：参数配置</h3>
            <p>这是第二步的内容。请配置相关参数。</p>
            <div class="form-group">
                <label>参数设置：</label>
                <input type="text" id="param-input" placeholder="请输入参数">
            </div>
        </div>
        
        <div class="wizard-step" id="step-3">
            <h3>步骤三：数据处理</h3>
            <p>这是第三步的内容。正在处理数据...</p>
            <div class="progress">
                <div class="progress-bar" style="width: 0%"></div>
            </div>
        </div>
        
        <div class="wizard-step" id="step-4">
            <h3>步骤四：结果展示</h3>
            <p>这是第四步的内容。显示处理结果。</p>
            <div class="result-display">
                <p>处理完成！</p>
            </div>
        </div>
    </div>

    <!-- 向导导航 -->
    <div class="wizard-navigation">
        <button type="button" class="btn btn-secondary" id="prev-btn" onclick="prevStep()" disabled>
            <i class="fas fa-arrow-left"></i> 上一步
        </button>
        <div class="navigation-info">
            <span class="step-indicator">步骤 1 / 4</span>
        </div>
        <button type="button" class="btn btn-primary" id="next-btn" onclick="nextStep()">
            下一步 <i class="fas fa-arrow-right"></i>
        </button>
    </div>
</div>

<style>
.form-group {
    margin: 1rem 0;
}

.form-group label {
    display: block;
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.form-group input {
    width: 100%;
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.progress {
    width: 100%;
    height: 20px;
    background-color: #f0f0f0;
    border-radius: 10px;
    overflow: hidden;
    margin: 1rem 0;
}

.progress-bar {
    height: 100%;
    background-color: #007bff;
    transition: width 0.3s ease;
}

.result-display {
    padding: 1rem;
    background-color: #d4edda;
    border: 1px solid #c3e6cb;
    border-radius: 4px;
    color: #155724;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
// 向导状态管理
let currentStep = 1;
const totalSteps = 4;

// 页面加载时初始化
document.addEventListener('DOMContentLoaded', function() {
    updateWizardUI();
    updateNavigationButtons();
    
    // 绑定文件输入事件
    document.getElementById('file-input').addEventListener('change', function() {
        if (this.files.length > 0) {
            console.log('文件已选择:', this.files[0].name);
            updateNavigationButtons();
        }
    });
    
    // 绑定参数输入事件
    document.getElementById('param-input').addEventListener('input', function() {
        updateNavigationButtons();
    });
});

// 更新向导UI
function updateWizardUI() {
    // 更新步骤指示器
    document.querySelectorAll('.wizard-steps .step').forEach((step, index) => {
        if (index + 1 === currentStep) {
            step.classList.add('active');
        } else {
            step.classList.remove('active');
        }
    });
    
    // 更新步骤内容
    document.querySelectorAll('.wizard-step').forEach((step, index) => {
        if (index + 1 === currentStep) {
            step.classList.add('active');
        } else {
            step.classList.remove('active');
        }
    });
    
    // 更新步骤指示器文本
    const stepIndicator = document.querySelector('.step-indicator');
    if (stepIndicator) {
        stepIndicator.textContent = `步骤 ${currentStep} / ${totalSteps}`;
    }
}

// 更新导航按钮状态
function updateNavigationButtons() {
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    
    // 上一步按钮
    prevBtn.disabled = currentStep === 1;
    
    // 下一步按钮
    const canProceed = canProceedToNextStep(currentStep);
    nextBtn.disabled = !canProceed || currentStep === totalSteps;
}

// 检查是否可以进入下一步
function canProceedToNextStep(step) {
    switch(step) {
        case 1:
            const fileInput = document.getElementById('file-input');
            return fileInput.files.length > 0;
        case 2:
            const paramInput = document.getElementById('param-input');
            return paramInput.value.trim() !== '';
        case 3:
            return true; // 第三步是自动处理
        case 4:
            return true;
        default:
            return false;
    }
}

// 下一步
function nextStep() {
    if (canProceedToNextStep(currentStep) && currentStep < totalSteps) {
        currentStep++;
        updateWizardUI();
        updateNavigationButtons();
        
        // 特殊处理
        if (currentStep === 3) {
            simulateProcessing();
        }
    }
}

// 上一步
function prevStep() {
    if (currentStep > 1) {
        currentStep--;
        updateWizardUI();
        updateNavigationButtons();
    }
}

// 模拟处理过程
function simulateProcessing() {
    const progressBar = document.querySelector('.progress-bar');
    let progress = 0;
    
    const interval = setInterval(() => {
        progress += 10;
        progressBar.style.width = progress + '%';
        
        if (progress >= 100) {
            clearInterval(interval);
            setTimeout(() => {
                nextStep();
            }, 500);
        }
    }, 200);
}

// 跳转到指定步骤
function goToStep(step) {
    if (step >= 1 && step <= totalSteps) {
        currentStep = step;
        updateWizardUI();
        updateNavigationButtons();
    }
}

// 绑定步骤点击事件
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.wizard-steps .step').forEach((step, index) => {
        step.addEventListener('click', () => {
            if (index + 1 <= currentStep) {
                goToStep(index + 1);
            }
        });
    });
});
</script>
{% endblock %}
